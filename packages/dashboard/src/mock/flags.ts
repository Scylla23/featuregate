import { subHours, subDays, subMinutes, subWeeks } from 'date-fns';
import type { Flag } from '@/types/flag';

const now = new Date();

export const MOCK_TAGS = [
  'frontend',
  'backend',
  'experiment',
  'beta',
  'internal',
  'marketing',
  'security',
  'performance',
  'payment',
  'deprecated',
  'growth',
  'infrastructure',
];

export const MOCK_AUTHORS: Record<string, { name: string; email: string; avatar?: string }> = {
  alex: { name: 'Alex Chen', email: 'alex@featuregate.io' },
  sarah: { name: 'Sarah Kim', email: 'sarah@featuregate.io' },
  mike: { name: 'Mike Johnson', email: 'mike@featuregate.io' },
  john: { name: 'John Doe', email: 'john@featuregate.io' },
  emma: { name: 'Emma Wilson', email: 'emma@featuregate.io' },
};

export const MOCK_FLAGS: Flag[] = [
  {
    _id: '1',
    key: 'new-onboarding',
    name: 'New Onboarding Flow',
    description: 'Redesigned onboarding experience with interactive product tour',
    projectId: 'proj_main',
    environmentKey: 'production',
    enabled: true,
    variations: [
      { value: true, name: 'Enabled' },
      { value: false, name: 'Disabled' },
    ],
    offVariation: 1,
    fallthrough: { variation: 0 },
    targets: [],
    rules: [
      {
        id: 'rule_1',
        clauses: [{ attribute: 'plan', operator: 'in', values: ['pro', 'enterprise'] }],
        variation: 0,
      },
    ],
    tags: ['frontend', 'growth'],
    archived: false,
    createdAt: subDays(now, 14).toISOString(),
    updatedAt: subHours(now, 2).toISOString(),
  },
  {
    _id: '2',
    key: 'ui-dark-mode',
    name: 'Dark Mode Beta',
    description: 'Enable dark mode theme across the application',
    projectId: 'proj_main',
    environmentKey: 'production',
    enabled: false,
    variations: [
      { value: true, name: 'Enabled' },
      { value: false, name: 'Disabled' },
    ],
    offVariation: 1,
    fallthrough: { variation: 0 },
    targets: [{ variation: 0, values: ['user_alex', 'user_sarah'] }],
    rules: [],
    tags: ['frontend', 'beta', 'internal'],
    archived: false,
    createdAt: subDays(now, 30).toISOString(),
    updatedAt: subDays(now, 1).toISOString(),
  },
  {
    _id: '3',
    key: 'marketing-q4-promo',
    name: 'Q4 Promo Banner',
    description: 'Seasonal promotional banner for Q4 marketing campaign',
    projectId: 'proj_main',
    environmentKey: 'production',
    enabled: true,
    variations: [
      { value: true, name: 'Show Banner' },
      { value: false, name: 'Hide Banner' },
    ],
    offVariation: 1,
    fallthrough: { variation: 0 },
    targets: [],
    rules: [],
    tags: ['frontend', 'marketing'],
    archived: false,
    createdAt: subDays(now, 7).toISOString(),
    updatedAt: subMinutes(now, 5).toISOString(),
  },
  {
    _id: '4',
    key: 'api-v1-shim',
    name: 'Legacy API Wrapper',
    description: 'Backward-compatible shim for v1 API endpoints',
    projectId: 'proj_main',
    environmentKey: 'production',
    enabled: true,
    variations: [
      { value: true, name: 'Active' },
      { value: false, name: 'Inactive' },
    ],
    offVariation: 1,
    fallthrough: { variation: 0 },
    targets: [],
    rules: [],
    tags: ['backend', 'deprecated'],
    archived: false,
    createdAt: subDays(now, 90).toISOString(),
    updatedAt: subWeeks(now, 2).toISOString(),
  },
  {
    _id: '5',
    key: 'pay-stripe-connect',
    name: 'Stripe Payment Integration',
    description: 'Enable Stripe Connect for marketplace payments',
    projectId: 'proj_main',
    environmentKey: 'production',
    enabled: true,
    variations: [
      { value: true, name: 'Enabled' },
      { value: false, name: 'Disabled' },
    ],
    offVariation: 1,
    fallthrough: {
      rollout: {
        variations: [
          { variation: 0, weight: 50000 },
          { variation: 1, weight: 50000 },
        ],
      },
    },
    targets: [],
    rules: [],
    tags: ['backend', 'payment', 'beta'],
    archived: false,
    createdAt: subDays(now, 5).toISOString(),
    updatedAt: subDays(now, 3).toISOString(),
  },
  {
    _id: '6',
    key: 'redis-cache-layer',
    name: 'Redis Cache Layer',
    description: 'Enable Redis caching for flag evaluation responses',
    projectId: 'proj_main',
    environmentKey: 'production',
    enabled: true,
    variations: [
      { value: true, name: 'Cached' },
      { value: false, name: 'Direct' },
    ],
    offVariation: 1,
    fallthrough: { variation: 0 },
    targets: [],
    rules: [],
    tags: ['backend', 'performance', 'infrastructure'],
    archived: false,
    createdAt: subDays(now, 60).toISOString(),
    updatedAt: subDays(now, 10).toISOString(),
  },
  {
    _id: '7',
    key: 'social-login-google',
    name: 'Google Social Login',
    description: 'Allow users to sign in via Google OAuth',
    projectId: 'proj_main',
    environmentKey: 'production',
    enabled: false,
    variations: [
      { value: true, name: 'Enabled' },
      { value: false, name: 'Disabled' },
    ],
    offVariation: 1,
    fallthrough: { variation: 0 },
    targets: [],
    rules: [],
    tags: ['frontend', 'security', 'beta'],
    archived: false,
    createdAt: subDays(now, 20).toISOString(),
    updatedAt: subDays(now, 8).toISOString(),
  },
  {
    _id: '8',
    key: 'webhook-notifications',
    name: 'Webhook Notifications',
    description: 'Send webhook events for flag changes and evaluations',
    projectId: 'proj_main',
    environmentKey: 'production',
    enabled: true,
    variations: [
      { value: true, name: 'Active' },
      { value: false, name: 'Inactive' },
    ],
    offVariation: 1,
    fallthrough: { variation: 0 },
    targets: [],
    rules: [
      {
        id: 'rule_wh1',
        clauses: [{ attribute: 'plan', operator: 'in', values: ['enterprise'] }],
        variation: 0,
      },
    ],
    tags: ['backend', 'infrastructure'],
    archived: false,
    createdAt: subDays(now, 45).toISOString(),
    updatedAt: subDays(now, 4).toISOString(),
  },
  {
    _id: '9',
    key: 'experiment-checkout-v2',
    name: 'Checkout V2 Experiment',
    description: 'A/B test for the redesigned checkout flow with single-page layout',
    projectId: 'proj_main',
    environmentKey: 'production',
    enabled: true,
    variations: [
      { value: 'control', name: 'Control' },
      { value: 'variant-a', name: 'Single Page' },
      { value: 'variant-b', name: 'Accordion' },
    ],
    offVariation: 0,
    fallthrough: {
      rollout: {
        variations: [
          { variation: 0, weight: 34000 },
          { variation: 1, weight: 33000 },
          { variation: 2, weight: 33000 },
        ],
      },
    },
    targets: [],
    rules: [],
    tags: ['frontend', 'experiment', 'growth'],
    archived: false,
    createdAt: subDays(now, 3).toISOString(),
    updatedAt: subHours(now, 6).toISOString(),
  },
  {
    _id: '10',
    key: 'rate-limiter-v2',
    name: 'Rate Limiter V2',
    description: 'Updated rate limiting with sliding window algorithm',
    projectId: 'proj_main',
    environmentKey: 'production',
    enabled: false,
    variations: [
      { value: true, name: 'Enabled' },
      { value: false, name: 'Disabled' },
    ],
    offVariation: 1,
    fallthrough: { variation: 0 },
    targets: [],
    rules: [],
    tags: ['backend', 'security', 'performance'],
    archived: false,
    createdAt: subDays(now, 12).toISOString(),
    updatedAt: subDays(now, 12).toISOString(),
  },
];

// Helper to get author for a flag (deterministic based on flag id)
const authorKeys = Object.keys(MOCK_AUTHORS);
export function getAuthorForFlag(flagId: string): { name: string; email: string } {
  const index = parseInt(flagId, 10) % authorKeys.length;
  return MOCK_AUTHORS[authorKeys[index]];
}
